# 암호화의 기초

## 용어정리
1. 평문 데이터
- 암호화하려는 파일/대상
2. 데이터 키
- 평문 데이터를 암호화 하는데 사용하는 알고리즘 입력값(like 비밀번호)
3. 암호문 데이터
- 암호화 된 데이터

암호화 유형
- 암/복호화 키
  - 동일한 경우 '대칭키 암호화'
  - 다른 경우 '비대칭키 암호화'

## AWS KMS
- 암호화키를 보호하고자 제공하는 도구 모음
- 암/복호화 및 단순 접근 등 키를 사용한 모든 작업의 로그를 저장하고 감사 추적이 가능함
- AES-256 알고리즘 사용
- 고객 마스터키(CMK)를 쉽게 생성, 관리, 통제 가능

장점
1. CMK 안전하고 내구성 있는 장소에 보관
2. CMK에 대한 접근 통제
3. CMK 고가용성 보장

### 기본 암호화
- 평문 데이터 크기가 4KB 미만인 경우 'AEK-256'으로 암/복호화 가능
![기본 암호화 흐름](./images/ch03_1.png)

1. CMK를 KMS 내부에 생성 및, 서비스별 접근 허용
2. KMS에 데이터 암호화 요청
3. KMS에서 서비스 A 인증/인가 후 암호화 처리한 데이터 응답
4. 서비스 A -> B로 데이터 전달
5. 서비스 B에서 KMS에 복호화 요청
6. KMS에서 서비스 B 인증/인가 후 복호화 한 평문 데이터 응답

#### AES-256 알고리즘 & 키 공간
- 키 공간(keyspace)은 해당 알고리즘으로 암호화 하는 과정에서 키가 '가질 수 있는 값의 범위'를 의미한다. 해당 키 공간으로 무차별 대입에 걸리는 시간을 추측 할 수 있다.
---
### 봉투 암호화
![봉투 암호화 흐름](./images/ch03_3.png)

**차이점** 
1. 데이터 키 2개 생성(기본, 암호화 된 버전)
2. 기본 데이터 키는 데이터 암호화 이후 삭제
3. 복호화시 데이터 키를 복호화해서 평문 데이터 키로 데이터 복호화 진행

![기본/봉투 암호화 차이](./images/ch03_2.png)
- CMK를 통해서 '데이터 키'를 복호화 함(CMK 접근 권한으로 데이터 안전 보장)
- 데이터 반복 암/복호화를 위한 평문 데이터 키를 서비스 메모리에 임시 저장(캐싱)이 가능
- 데이터와 키 저장소를 분리함
