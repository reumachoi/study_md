# 레디스자료구조활용사례

## sorted set 활용 
자료구조 특징
- 데이터 저장 시점부터 정렬

커맨드
- 저장: ZADD
- 조회: ZRANGE <-> ZREVRANGE
- 증감: ZINCRBY
- 합산: ZUNIONSTORE (+ WEIGHTS로 가중치 가능)
- 삭제: ZREMRANGEBYRANK
- 필드 조회: SMEMBERS
- 교집합 조회: SINTER
- 랜덤 추출: ZRANDMEMBER
- 

### 실시간 리더보드(점수 순위표)
고려해야할 서비스 특징
- 사용자 증가에 따른 데이터 처리량 증가
- 실시간 반영 서비스
- 상대적으로 표시의 경우 다양한 그룹별 데이터 계산 및 통계 필요

### 최근 검색 기록
고려해야할 서비스 특징
- 유저별로 다른 키워드 노출
- 검색 내역은 중복 제거
- 가장 최근 검색한 5개의 키워드만 사용자에게 노출

### 태그 기능
고려해야할 서비스 특징
- 게시글 기준 -> 태그 기록
- 태그 기준 -> 게시글 기록

## 랜덤 데이터 추출
- HRANDFIELD, SRANDMEMBER, ZRANDMEMBER

## 카운팅 방법
### 좋아요 처리 (set)
- 댓글 id - 좋아요를 누른 유저 id  
-> 댓글별 value값 개수 확인

### 읽지 않은 메시지 수 카운트 (hash)
- 사용자의 id 기준 키 - 채널 id  
-> 유저가 속한 채널별 쌓인 메시지 수 확인

### DAU 구하기 (bit)
- 메모리 효율적 사용 및 빠른 처리  
- 접속 유저 id의 bit=1 설정 (= 오프셋 번호 값 업데이트)  
- 합산('BITOP AND') 후 애플리케이션에서 list 변환 사용 가능

## hyperloglog 활용
해당조건 만족시 추천
- 집합 내 유일한 데이터 수 카운팅
- 1% 미만의 오차 허용 가능
- 데이터의 정확도 확인 불필요

### 로그 저장
- 유저아이디:날짜 - 로그 식별자
- 합산('PFMERGE') 후 분기, 연도별 등 합산 가능

## Geospatial Index
위치 데이터 기능
- 대상의 현재 위치 파악
- 대상 이동에 따른 실시간 변동 위치 업데이트
- 대상 기준의 근처 장소 검색

### 위치 기반 애플리케이션
geo set
- 경도&위도 - 대상 id
-> 내부적으로 sorted set 구조 저장

geo search
- 그룹에서 특정 위치 기준으로 반경 내 데이터 검색 가능
- cmd: BYRADIUS(반지름), BYBOX(직사각형 )


