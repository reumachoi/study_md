# 마이크로서비스 아키텍처와 레디스

## NoSQL의 등장 배경
### 아키텍쳐
1. 모놀리틱
- 정의: 전체 애플리케이션을 하나의 통합된 패키지로 개발, 배포
- 장점: 작은 규모의 경우 운영이 간편
- 단점: 모듈 수정시 전체적 배포해야하는 영향 범위가 큼 -> 전체 시스템 장애 전파 가능

2. 마이크로서비스
- 정의: 독립된 각각의 모듈을 조립해 하나의 서비스를 만듦 
- 장점: 변경이 필요한 모듈만 기능을 작업을 진행하여 독립성 및 안정성 확보, 확장성에 용이
- 단점: 소규모 팀이 관리하기엔 복잡도로 인해 운영 부담 증가

-> 모놀리틱에서 마이크로서비스 아키텍쳐로 업계 트렌드가 변화해 감

### 데이터베이스 요구 사항의 변화
- 크기와 구조를 예측할 수 없는 비정형 데이터(ex. 그래프 데이터, 시계열 데이터) 증가함
- JSON 데이터를 column으로 알맞게 정의하는데 어려움
- RDBMS로는 테이블 구조 변경에 많은 공수가 들어가며, 관계복잡성 증가시 성능 최적화가 중요해짐
- 마이크로서비스 아키텍처 서비스간의 독립성을 보장하기 위해 의존성을 낮춰야함. 서비스별 특성에 맞는 데이터베이스 선택 및 독립 관리가 필요함

-> 요구사항에 맞게 확장성과 유연성을 가진 데이터베이스의 필요성 증가

***

## NoSQL이란?
- 관계가 정의되지 않은 데이터를 저장
- 마이크로서비스 환경에서의 요구사항을 충족하기 위한 요구 사항 만족

### 특징
1. 실시간 응답
- 스키마에 따른 액세스 패턴 최적화로 빠른 응답 제공
2. 확장성
- RDBMS는 '샤딩'이 가능하나 수평확장 기능이 내재되어 있지 않음
- NoSQL은 내장된 '샤딩' 및 '고가용성' 기능을 통해 '수평 확장' 가능
3. 고가용성
- '자동 복제'를 통해 장애 상황에서 신속 복구 가능
4. 클라우드 네이티브
- 클라우드 환경에 최적화되어 배포 및 관리 간소화
5. 단순성
- 단일 데이터베이스로 다양한 유형의 데이터 처리 가능
6. 유연성
- 비정형 데이터를 처리하기 위한 다양한 스키마 선택 가능


### 데이터 저장 유형(스키마)
1. Graph
- 엔티티(노드) 간의 관계(에지)를 저장함.
- 에지는 노드간의 방향을 나타내고 관계, 동작, 소유자 등의 정보 저장
- ex) 추천서비스
  - SNS에서 사용자와 친구의 관계를 이용한 새로운 친구 추천
  - 쇼핑몰에서 관심 분야나 구매 이력이 비슷한 유저를 파악해 상품 추천 

2. Column
- 테이블의 '열(column)'을 기준으로 저장함
- 하나의 열에 중첩된 키-값 형태로 저장 가능
- 대량 데이터 집계 쿼리를 빠르게 처리 가능
- ex) 빅데이터 처리
  - Apache Cassandra


3. Document
- JSON 형태로 데이터를 저장하여, 효율적이고 직관적 사용 가능
- 모든 값은 항상 키와 연결되는 계층적 트리 구조
- 데이터 저장 및 검색 용이
- ex) MongoDB, AWS Document DB

4. Key-Value
- 모든 값은 키와 연결되어 있음
- 키를 사용해 값 검색 가능, 키 삭제시 값도 삭제
- 구조의 단순성으로 빠른 데이터 액세스 및 처리속도 보장 가능
- ex) AWS ElastiCache(캐싱 및 임시저장), AWS DynamoDB(데이터 영구 저장)

***
## Redis
- key-value InMemory NoSQL Database

### 특징
1. 실시간 응답(빠른 성능)
- 디스크 접근 과정이 필요 없기 때문에 데이터 처리 성능이 빠름
2. 단순성
- String, Hash, List, Set 등 다양한 자료구조 저장 지원  
  (RDBMS와 프로그래밍 언어 간 데이터 구조, 기능 차이로 충돌하는 '임피던스 불일치' 문제 해소)
- 이벤트 루프를 이용한 싱글 스레드 동작  
  (대부분의 커맨드는 빠른 응답 시간을 가짐. but, 한 사용자가 오래 걸리는 커맨드 수행시 완료될 때까지 전부 대기)
3. 고가용성
- 자체 HA 기능 제공
- 복제를 통해 데이터를 다중서버로 분산저장
- '센티넬' 사용시 엔드포인트 변경 없이 자동 페일오버로 정상 사용가능
4. 확장성
- '클러스터' 사용시 쉽게 수평확장 가능
- 데이터는 자동 샤딩 후 저장, 여러개 복제본 생성 가능
- 클러스터 내에서 '클러스터 버스' 프로토콜을 이용해 서로 감시하여 자동 페일오버로 고가용성 유지 가능
5. 클라우드 네이티브-멀티 클라우드
- 각 클라우드 서비스 제공자의 강점 활용
- 대기시간을 줄이고 장애 상황에 강건하게 대응 가능
- 여러 클라우드에 일관된 성능과 기능 제공으로 서비스의 연속성과 데이터 일관성 보장

***
## MSA에서의 레디스 활용방식
### 데이터 저장소
- 각 서비스별 개별 저장소로 사용 (최소한의 리소스로 막대한 처리량 가능, 다양한 자료 구조 제공 등 편의성 제공)
- 데이터 디스크 저장 가능
  - AOF(write command logs)
  - RDB(snapshot)

### 메시지 브로커
- pub/sub: 채널에 데이터 발행 및 구독으로 전달 가능. 데이터는 전달된 뒤 삭제 됨(일회성)
- MQ: 레디스 list 자료구조로 push/pop 데이터 추가 및 획득 가능. 블로킹 기능으로 데이터 추가까지 대기.
- stream: kafka 기반으로 만들어져, 데이터가 계속 추가됨(append-only). 여러 소비자&소비자 그룹으로 데이터 분산 처리 가능.
